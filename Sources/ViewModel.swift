//
//  ViewModel.swift
//  IPRange
//
//  Created by Mac on 8/12/25.
//

import SwiftUI

let listAddress: [String] = [
    "101.47.17.247",
    "101.47.19.149",
    "103.174.236.57",
    "103.187.39.21",
    "103.189.218.158",
    "103.249.201.229",
    "103.252.92.164",
    "103.78.201.242",
    "103.90.226.245",
    "104.236.171.128",
    "104.244.74.206",
    "109.123.235.224",
    "109.248.235.46",
    "113.176.118.150",
    "115.127.67.26",
    "115.72.173.63",
    "116.107.203.105",
    "116.202.208.254",
    "116.98.196.218",
    "117.250.3.58",
    "117.3.251.199",
    "118.70.151.55",
    "123.143.162.221",
    "132.148.128.88",
    "137.184.152.66",
    "138.124.49.149",
    "138.201.124.98",
    "139.59.234.208",
    "139.59.24.173",
    "139.59.36.226",
    "140.238.30.184",
    "141.195.112.103",
    "141.94.190.221",
    "141.94.195.25",
    "143.47.59.115",
    "144.124.228.87",
    "144.91.71.101",
    "145.239.5.238",
    "146.0.78.109",
    "146.103.99.6",
    "146.190.16.167",
    "146.56.101.184",
    "147.135.62.204",
    "150.129.115.253",
    "152.53.168.53",
    "152.53.36.109",
    "152.70.100.52",
    "154.223.20.58",
    "159.223.164.184",
    "159.65.128.194",
    "159.89.164.144",
    "161.35.70.249",
    "162.19.107.54",
    "162.19.60.219",
    "162.241.125.171",
    "162.241.73.195",
    "163.172.128.222",
    "163.172.137.227",
    "163.172.167.106",
    "163.172.171.42",
    "163.172.172.161",
    "163.172.176.95",
    "163.172.187.22",
    "163.53.204.178",
    "164.132.49.123",
    "166.62.121.102",
    "166.62.53.45",
    "167.71.204.247",
    "171.224.49.175",
    "171.227.171.148",
    "171.247.245.149",
    "171.247.246.76",
    "171.249.210.168",
    "172.105.120.120",
    "176.108.253.15",
    "176.117.237.132",
    "178.130.43.7",
    "178.32.202.54",
    "178.32.202.54",
    "178.33.77.209",
    "178.49.236.109",
    "184.170.245.139",
    "185.102.115.39",
    "185.126.128.168",
    "185.231.204.221",
    "185.255.132.48",
    "185.93.89.143",
    "185.93.89.144",
    "185.93.89.145",
    "185.93.89.146",
    "185.93.89.150",
    "185.93.89.158",
    "185.93.89.188",
    "186.26.95.249",
    "188.128.86.74",
    "188.165.192.99",
    "188.191.164.55",
    "188.191.164.55",
    "188.235.139.93",
    "190.119.160.29",
    "192.129.175.157",
    "192.241.243.131",
    "192.95.33.162",
    "193.111.63.190",
    "193.123.252.70",
    "193.70.32.184",
    "195.201.91.95",
    "195.91.129.101",
    "198.12.249.249",
    "198.44.171.27",
    "2.63.188.78",
    "205.185.113.92",
    "207.154.230.54",
    "207.180.208.185",
    "208.109.9.250",
    "209.74.81.111",
    "212.23.69.121",
    "212.34.152.172",
    "212.47.229.46",
    "212.47.232.161",
    "212.47.234.241",
    "212.47.235.189",
    "212.47.240.118",
    "212.47.240.97",
    "212.47.248.107",
    "212.47.250.24",
    "212.47.253.40",
    "212.47.253.53",
    "213.147.123.49",
    "213.250.198.146",
    "217.173.31.28",
    "220.247.163.185",
    "23.157.88.25",
    "23.81.207.123",
    "24.199.103.116",
    "27.72.100.236",
    "27.79.216.31",
    "27.79.243.67",
    "31.129.147.102",
    "31.211.142.115",
    "37.120.162.180",
    "37.157.217.144",
    "37.18.73.60",
    "38.54.50.193",
    "42.113.104.203",
    "43.133.32.76",
    "43.163.124.13",
    "45.10.26.200",
    "45.12.132.138",
    "45.12.132.145",
    "45.138.69.35",
    "45.142.193.224",
    "45.142.193.234",
    "45.146.130.16",
    "45.146.130.46",
    "45.33.95.52",
    "45.78.208.219",
    "46.146.204.175",
    "46.146.220.180",
    "46.229.66.241",
    "46.229.66.241",
    "47.237.119.129",
    "47.237.78.78",
    "47.237.92.3",
    "47.242.130.60",
    "47.251.103.231",
    "47.83.8.254",
    "5.128.254.99",
    "5.129.232.77",
    "5.129.246.91",
    "5.161.146.73",
    "5.172.24.68",
    "5.183.70.46",
    "5.252.21.13",
    "5.75.168.247",
    "5.9.98.142",
    "51.15.210.190",
    "51.15.232.175",
    "51.15.236.150",
    "51.158.117.213",
    "51.158.70.181",
    "51.158.70.246",
    "51.158.71.156",
    "51.178.68.226",
    "51.178.68.226",
    "51.210.111.216",
    "51.222.108.216",
    "51.75.126.150",
    "51.83.190.248",
    "51.83.66.117",
    "51.89.21.99",
    "54.36.12.122",
    "54.36.13.94",
    "54.36.176.100",
    "54.37.95.218",
    "64.227.124.137",
    "66.29.138.31",
    "66.29.138.67",
    "68.178.164.136",
    "70.36.101.157",
    "77.41.167.137",
    "77.50.104.110",
    "78.29.46.43",
    "8.210.225.66",
    "8.210.89.96",
    "8.217.231.95",
    "8.222.251.136",
    "80.75.213.22",
    "82.200.235.134",
    "82.223.165.28",
    "82.46.149.107",
    "83.169.255.92",
    "84.17.27.253",
    "85.172.55.85",
    "85.209.9.247",
    "87.117.11.57",
    "87.98.148.34",
    "89.148.196.156",
    "89.46.249.170",
    "89.58.45.94",
    "91.107.136.65",
    "91.121.173.38",
    "91.185.55.146",
    "91.211.115.127",
    "91.221.70.29",
    "92.118.169.34",
    "92.205.60.110",
    "93.187.188.30",
    "93.91.162.222",
    "94.23.11.131",
    "94.23.222.122",
    "94.233.120.194",
    "94.73.251.19",
    "95.188.64.220",
    "97.74.81.253"]


struct AddressElement: Identifiable {
    let id = UUID()
    var address: String
    var country: String
    var flag: String
}

// MARK: ContentView
extension ContentView {
    @Observable
    class ViewModel {
        internal var addresses: [AddressElement] = []
        internal var addressRanges = AddressRanges( locator: IPAddressRangeLocator())
        
        init() {
            listAddress.forEach { address in
                if let country = country(for: address),
                   let flag = flag(for: address) {
                    let item = AddressElement(address: address, country:country, flag:flag)
                    addresses.append(item)
                }
            }
        }
    }
}

extension ContentView.ViewModel {
    func country(for address: String) -> String? {
        do {
            let range = try self.addressRanges.location(with: address)
            return self.addressRanges.country(with: range)
        } catch {
            return nil
        }
    }
    func start(for address: String) -> String? {
        do {
            let range = try self.addressRanges.location(with: address)
            return self.addressRanges.start(with: range)
        } catch {
            return nil
        }
    }
    func end(for address: String) -> String? {
        do {
            let range = try self.addressRanges.location(with: address)
            return self.addressRanges.end(with: range)
        } catch {
            return nil
        }
    }
    func subdivision(for address: String) -> String? {
        do {
            let range = try self.addressRanges.location(with: address)
            return self.addressRanges.subdivision(with: range)
        } catch {
            return nil
        }
    }
    func flag(for address: String) -> String? {
        do {
            let range = try self.addressRanges.location(with: address)
            return self.addressRanges.flag(with: range)
        } catch {
            return nil
        }
    }
}
